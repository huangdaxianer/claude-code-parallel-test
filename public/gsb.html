<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSB ËØÑÊµã - ÊñπËàü‰ºóÊµãÂπ≥Âè∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/gsb.css">
</head>

<body>
    <div class="gsb-layout">
        <!-- Sidebar Toggle (floating ball when collapsed) -->
        <button class="gsb-sidebar-toggle" id="gsb-sidebar-toggle" onclick="GSB.toggleSidebar()" title="Â±ïÂºÄ‰æßÊ†è">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <!-- Sidebar -->
        <aside class="gsb-sidebar" id="gsb-sidebar">
            <div class="gsb-sidebar-header">
                <button class="gsb-sidebar-collapse-btn" onclick="GSB.toggleSidebar()" title="Êî∂Ëµ∑‰æßÊ†è">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <a href="/task.html" class="gsb-back-link">‚Üê ËøîÂõû‰ªªÂä°ÂàóË°®</a>
                <h1>GSB ËØÑÊµã</h1>
                <button class="btn-new-job" onclick="GSB.openCreateModal()">
                    <span>+</span> Êñ∞Âª∫ GSB ËØÑÊµã
                </button>
            </div>
            <div class="gsb-job-list" id="gsb-job-list">
                <div class="gsb-empty-state" style="padding: 2rem; text-align: center;">
                    <p style="color: #94a3b8;">Âä†ËΩΩ‰∏≠...</p>
                </div>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="gsb-main">
            <div class="gsb-work-area" id="gsb-work-area">
                <!-- Empty State -->
                <div class="gsb-empty-state" id="gsb-empty-state">
                    <div class="icon">‚öñÔ∏è</div>
                    <p>ÈÄâÊã©‰∏Ä‰∏™ËØÑÊµã‰Ωú‰∏öÂºÄÂßãÊâìÂàÜ</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem;">ÊàñÁÇπÂáª„ÄåÊñ∞Âª∫ GSB ËØÑÊµã„ÄçÂàõÂª∫Êñ∞‰Ωú‰∏ö</p>
                </div>

                <!-- Scoring View (hidden by default) -->
                <div id="gsb-scoring-view" style="display: none; flex: 1; flex-direction: column;">
                    <div class="gsb-scoring-header">
                        <div class="gsb-task-info">
                            <h2 id="scoring-task-title">‰ªªÂä°Ê†áÈ¢ò</h2>
                            <div class="prompt-preview-row">
                                <div class="prompt-preview" id="scoring-task-prompt">‰ªªÂä° Prompt...</div>
                                <button class="prompt-expand-btn" id="prompt-expand-btn" onclick="GSB.showFullPrompt()" style="display:none;">Â±ïÂºÄ</button>
                            </div>
                        </div>
                        <div class="gsb-progress-info" id="scoring-progress">1 / 10</div>
                    </div>
                    <div class="gsb-preview-area">
                        <div class="gsb-preview-panel" id="preview-panel-a">
                            <div class="gsb-preview-header left">
                                <span class="model-label" id="model-a-label">Model A</span>
                            </div>
                            <div class="gsb-preview-status-bar" id="preview-status-bar-a" style="display:none;">
                                <div style="display:flex;align-items:center;gap:0.5rem;">
                                    <span class="gsb-status-dot" id="preview-status-dot-a"></span>
                                    <span class="gsb-status-text" id="preview-status-text-a">Ready</span>
                                </div>
                                <div style="display:flex;gap:0.5rem;">
                                    <button class="gsb-preview-btn" id="preview-fullscreen-a" onclick="GSB.openFullscreen('a')" style="display:none;">‚Üó ÂÖ®Â±èÊâìÂºÄ</button>
                                    <button class="gsb-preview-btn" onclick="GSB.restartPreview('a')">üîÑ ÈáçÂêØÊúçÂä°</button>
                                </div>
                            </div>
                            <div class="gsb-preview-logs" id="preview-logs-a" style="display:none;"></div>
                            <iframe id="preview-iframe-a" class="gsb-preview-iframe"></iframe>
                        </div>
                        <div class="gsb-resize-handle" id="gsb-resize-handle"></div>
                        <div class="gsb-preview-panel" id="preview-panel-b">
                            <div class="gsb-preview-header right">
                                <span class="model-label" id="model-b-label">Model B</span>
                            </div>
                            <div class="gsb-preview-status-bar" id="preview-status-bar-b" style="display:none;">
                                <div style="display:flex;align-items:center;gap:0.5rem;">
                                    <span class="gsb-status-dot" id="preview-status-dot-b"></span>
                                    <span class="gsb-status-text" id="preview-status-text-b">Ready</span>
                                </div>
                                <div style="display:flex;gap:0.5rem;">
                                    <button class="gsb-preview-btn" id="preview-fullscreen-b" onclick="GSB.openFullscreen('b')" style="display:none;">‚Üó ÂÖ®Â±èÊâìÂºÄ</button>
                                    <button class="gsb-preview-btn" onclick="GSB.restartPreview('b')">üîÑ ÈáçÂêØÊúçÂä°</button>
                                </div>
                            </div>
                            <div class="gsb-preview-logs" id="preview-logs-b" style="display:none;"></div>
                            <iframe id="preview-iframe-b" class="gsb-preview-iframe"></iframe>
                        </div>
                    </div>
                    <div class="gsb-rating-area">
                        <button class="gsb-rating-btn left" onclick="GSB.submitRating('left_better')">
                            üëà Â∑¶ËæπÁöÑÂ•Ω
                        </button>
                        <button class="gsb-rating-btn same" onclick="GSB.submitRating('same')">
                            ü§ù Â∑Æ‰∏çÂ§ö
                        </button>
                        <button class="gsb-rating-btn right" onclick="GSB.submitRating('right_better')">
                            Âè≥ËæπÁöÑÂ•Ω üëâ
                        </button>
                        <button class="gsb-rating-btn failed" onclick="GSB.submitRating('failed')">
                            ‚ùå Âä†ËΩΩÂ§±Ë¥•
                        </button>
                    </div>
                </div>

                <!-- Results View (hidden by default) -->
                <div id="gsb-results-view" class="gsb-results-view" style="display: none;">
                    <div class="gsb-results-header">
                        <h2 id="results-job-name">‰Ωú‰∏öÂêçÁß∞</h2>
                        <p id="results-models">Model A vs Model B</p>
                    </div>
                    <div class="gsb-results-cards">
                        <div class="gsb-result-card left">
                            <div class="value" id="result-model-a-wins">0</div>
                            <div class="label" id="result-model-a-label">Model A ËÉúÂá∫</div>
                        </div>
                        <div class="gsb-result-card right">
                            <div class="value" id="result-model-b-wins">0</div>
                            <div class="label" id="result-model-b-label">Model B ËÉúÂá∫</div>
                        </div>
                        <div class="gsb-result-card same">
                            <div class="value" id="result-same">0</div>
                            <div class="label">Âπ≥Â±Ä</div>
                        </div>
                        <div class="gsb-result-card failed">
                            <div class="value" id="result-failed">0</div>
                            <div class="label">Âä†ËΩΩÂ§±Ë¥•</div>
                        </div>
                    </div>

                    <!-- Task Details Table -->
                    <div class="gsb-results-details">
                        <h3>ÂàÜ‰ªªÂä°ËØÑÂàÜËØ¶ÊÉÖ</h3>
                        <table class="gsb-results-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">#</th>
                                    <th>‰ªªÂä°Ê†áÈ¢ò</th>
                                    <th style="width: 120px;">ËØÑÂàÜÁªìÊûú</th>
                                </tr>
                            </thead>
                            <tbody id="results-task-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Job Modal -->
    <div class="gsb-modal" id="create-job-modal">
        <div class="gsb-modal-content">
            <div class="gsb-modal-header">
                <h3>Êñ∞Âª∫ GSB ËØÑÊµã</h3>
                <button class="gsb-modal-close" onclick="GSB.closeCreateModal()">&times;</button>
            </div>
            <div class="gsb-modal-body">
                <!-- Step 1: Model Selection -->
                <div id="create-step-1">
                    <div class="gsb-steps">
                        <div class="gsb-step active">
                            <span class="gsb-step-number">1</span>
                            <span>ÈÄâÊã©Ê®°Âûã</span>
                        </div>
                        <div class="gsb-step-divider"></div>
                        <div class="gsb-step">
                            <span class="gsb-step-number">2</span>
                            <span>ÈÄâÊã©‰ªªÂä°</span>
                        </div>
                    </div>

                    <div class="gsb-form-group">
                        <label>‰Ωú‰∏öÂêçÁß∞</label>
                        <input type="text" id="job-name-input" placeholder="‰æãÂ¶ÇÔºöpotato vs tomato ÂØπÊØîËØÑÊµã">
                    </div>
                    <div class="gsb-form-group">
                        <label>Ê®°Âûã A</label>
                        <select id="model-a-select">
                            <option value="">ËØ∑ÈÄâÊã©Ê®°Âûã...</option>
                        </select>
                    </div>
                    <div class="gsb-form-group">
                        <label>Ê®°Âûã B</label>
                        <select id="model-b-select">
                            <option value="">ËØ∑ÈÄâÊã©Ê®°Âûã...</option>
                        </select>
                    </div>
                </div>

                <!-- Step 2: Task Selection -->
                <div id="create-step-2" style="display: none;">
                    <div class="gsb-steps">
                        <div class="gsb-step">
                            <span class="gsb-step-number">‚úì</span>
                            <span>ÈÄâÊã©Ê®°Âûã</span>
                        </div>
                        <div class="gsb-step-divider"></div>
                        <div class="gsb-step active">
                            <span class="gsb-step-number">2</span>
                            <span>ÈÄâÊã©‰ªªÂä°</span>
                        </div>
                    </div>

                    <p style="margin-bottom: 1rem; color: #64748b; font-size: 0.9rem;">
                        ÈÄâÊã©Ë¶ÅËØÑÊµãÁöÑ‰ªªÂä°„ÄÇÂè™Êúâ‰∏§‰∏™Ê®°ÂûãÈÉΩÁîüÊàê‰∫ÜÂèØÈ¢ÑËßàÁªìÊûúÁöÑ‰ªªÂä°ÊâçËÉΩË¢´ÈÄâ‰∏≠„ÄÇ
                    </p>

                    <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 0.5rem;">
                        <table class="gsb-task-table">
                            <thead id="task-selection-thead">
                                <tr>
                                    <th style="width: 40px;">
                                        <input type="checkbox" class="gsb-checkbox" id="select-all-tasks"
                                            onchange="GSB.toggleAllTasks(this.checked)">
                                    </th>
                                    <th style="width: 100px;">‰ªªÂä°Ê†áÈ¢ò</th>
                                    <th>Prompt</th>
                                    <th style="width: 90px;" id="th-model-a">
                                        <div class="model-header">
                                            <span class="model-name">Model A</span>
                                            <span class="preview-label">È¢ÑËßàÁä∂ÊÄÅ</span>
                                        </div>
                                    </th>
                                    <th style="width: 90px;" id="th-model-b">
                                        <div class="model-header">
                                            <span class="model-name">Model B</span>
                                            <span class="preview-label">È¢ÑËßàÁä∂ÊÄÅ</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="task-selection-tbody">
                                <tr>
                                    <td colspan="5" style="text-align: center; color: #94a3b8; padding: 2rem;">
                                        Âä†ËΩΩ‰∏≠...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div style="margin-top: 1rem; display: flex; align-items: center; justify-content: space-between;">
                        <span id="selected-task-count" style="color: #64748b; font-size: 0.9rem;">Â∑≤ÈÄâÊã© 0 ‰∏™‰ªªÂä°</span>
                    </div>
                </div>
            </div>
            <div class="gsb-modal-footer">
                <button class="gsb-btn" id="modal-back-btn" onclick="GSB.prevStep()" style="display: none;">‰∏ä‰∏ÄÊ≠•</button>
                <button class="gsb-btn" onclick="GSB.closeCreateModal()">ÂèñÊ∂à</button>
                <button class="gsb-btn gsb-btn-primary" id="modal-next-btn" onclick="GSB.nextStep()">‰∏ã‰∏ÄÊ≠•</button>
            </div>
        </div>
    </div>

    <!-- Job Dropdown Menu -->
    <div class="gsb-job-dropdown" id="gsb-job-dropdown">
        <button class="gsb-job-dropdown-item" onclick="GSB.deleteJobFromMenu()">Âà†Èô§</button>
    </div>

    <!-- Full Prompt Modal -->
    <div class="gsb-modal" id="prompt-modal">
        <div class="gsb-modal-content" style="max-width: 640px;">
            <div class="gsb-modal-header">
                <h3>ÂÆåÊï¥ÊèêÁ§∫ËØç</h3>
                <button class="gsb-modal-close" onclick="GSB.closeFullPrompt()">&times;</button>
            </div>
            <div class="gsb-modal-body">
                <div id="prompt-modal-text" style="white-space: pre-wrap; line-height: 1.7; color: #334155; font-size: 0.9rem;"></div>
            </div>
        </div>
    </div>

    <script src="js/gsb.js"></script>
    <script>
        // Fixed-position tooltip for .preview-info-tip (avoids overflow:hidden clipping)
        (function () {
            let tip = null;
            document.addEventListener('mouseover', function (e) {
                const el = e.target.closest('.preview-info-tip');
                if (!el) return;
                if (tip) tip.remove();
                const text = el.getAttribute('data-tip');
                if (!text) return;
                tip = document.createElement('div');
                tip.textContent = text;
                tip.style.cssText = 'position:fixed;z-index:99999;background:#1e293b;color:#f1f5f9;font-size:12px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;line-height:1.5;padding:6px 10px;border-radius:6px;max-width:320px;pointer-events:none;white-space:normal;';
                document.body.appendChild(tip);
                const rect = el.getBoundingClientRect();
                tip.style.top = (rect.bottom + 6) + 'px';
                tip.style.left = rect.left + 'px';
                // Prevent overflow right
                const tipRect = tip.getBoundingClientRect();
                if (tipRect.right > window.innerWidth - 8) {
                    tip.style.left = (window.innerWidth - tipRect.width - 8) + 'px';
                }
            });
            document.addEventListener('mouseout', function (e) {
                const el = e.target.closest('.preview-info-tip');
                if (el && tip) { tip.remove(); tip = null; }
            });
        })();
    </script>
</body>

</html>